kind: pipeline
name: default

steps:
    - name: test
      image: python
      commands:
        - pip install -r requirements.txt
        - pytest
    #- name: publish
    #  image: plugins/docker
    #  settings:
    #    repo: mneiding/drone_ci_test
    #    tags: [ "${DRONE_COMMIT_SHA:0:7}","latest" ]
    #    username:
    #        from_secret: DOCKERHUB_USERNAME
    #    password:
    #        from_secret: DOCKERHUB_PASSWORD
    - name: notify
      image: plugins/webhook
      settings:
        urls: https://webexapis.com/v1/messages
        content_type: application/json
        environment:
            WEBEX_TOKEN:
                from_secret: TOKEN
        headers:
            -"Authorization=Bearer $WEBEX_TOKEN"
        template: |
            {
                "roomId": "Y2lzY29zcGFyazovL3VzL1JPT00vOWY4ZmQwNzAtZjM1YS0xMWVhLThiMDktZDE1MjI0YTkyNjZl"
                "markdown": "Hello from the build"
            }
